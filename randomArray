#!/usr/bin/perl

my ($N, $min, $max) = @ARGV[0..2];
my $replace = $ARGV[3] eq '--replace' ? 1 : 0;

open OUT, "> randomArray.R";
print OUT &script;
close OUT;

my $Rscript = 'randomArray.R';
my $cmd =  "R --vanilla < $Rscript > /dev/null --args $$ $N $min $max $replace";
print STDERR "DOWNSAMPLING: $cmd\n";
system $cmd;

my $tmp = "randomArray.$$.$N.$min.$max.$replace.tmp";  # generated by R script
open IN, $tmp or die "$0: Failed to open temp file '$tmp': $!\n";
print (<IN>);
close IN;

#system "rm -f $Rscript";
#system "rm -f $tmp";
exit;


sub script {

    ## as heredoc, in case the hardcopy gets lost

my $script = <<EOF;

x <- as.numeric(commandArgs(trailingOnly=TRUE))
write(sample(x[2]:x[3], x[1], replace=as.logical(x[5])), file=paste(c("randomArray",x,"tmp"), collapse="."), ncol=1)

EOF

return $script;
}
